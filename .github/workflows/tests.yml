name: Python package

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.6.7]

    steps:
    - uses: actions/checkout@v2
      name: setup python
    - uses: borales/actions-yarn@v2.0.0
        with:
          cmd: install # will run `yarn install` command
    - uses: borales/actions-yarn@v2.0.0
        with:
          cmd: build # will run `yarn install` command
    - name: Set up Python 3.6.7
      uses: actions/setup-python@v2
      with:
        python-version: 3.6.7
    - name: Install dependencies
      run: |
        # install conda
        wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
        bash miniconda.sh -b -p $HOME/miniconda
        export PATH="$HOME/miniconda/bin:$PATH"
        hash -r
        conda config --set always_yes yes --set changeps1 no
        conda update -q conda
        # install yarn
        curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.12.1
        export PATH="$HOME/.yarn/bin:$PATH"
        # Useful for debugging any issues with conda
        conda info -a
    - name: install
      run: |
          yarn
          yarn --cwd js
          conda create -q -n test-environment python=$TRAVIS_PYTHON_VERSION coveralls
          source activate test-environment
          #now we are in an environment
          conda install -c potassco clingo
          pip install -r requirements.txt
          pip install -e .
    - name: Test with pytest
      run: |
        yarn --cwd js build
        python setup.py test
        coveralls
